#version 330 core
out vec4 fragCol;
in vec3 outModel;
in vec3 outNormal;
in vec3 outPos;
in vec2 outUV;
in vec4 outCol;
flat in int selected;

uniform int debug;
uniform float playerX;
uniform float playerY;
uniform float playerZ;

vec3 Fog(float dist, vec3 inCol, vec3 col, float minDist, float maxDist) {
  float factor = (maxDist - dist) / (maxDist - minDist);
  factor = clamp(factor, 0.0, 1.0);
  return mix(col, inCol, factor);
}

void main() {
  vec2 uv = outUV;
  vec3 playerPos = vec3(playerX, playerY, playerZ);
  vec3 lightPos = vec3(0.0, 300.0, 0.0);
  vec3 objCol = vec3(1.0, 1.0, 1.0);
  vec3 norm = normalize(outNormal);
  
  // vec3 lightDir = normalize(lightPos - outModel);
  vec3 lightDir = vec3(0.0, 0.7, 0.3);
  float diff = max(dot(norm, lightDir), 0.0);
  vec3 ambient = vec3(0.05, 0.15, 0.2);
  vec3 background = vec3(0.03, 0.01, 0.04);
  vec3 diffuse = diff*vec3(1.0, 1.0, 1.0);
  vec3 result = (ambient + diffuse) * objCol;
  float fogDist = distance(outModel, playerPos);
  fragCol = vec4(Fog(fogDist, result, ambient, -1.0, 1440.0), 1.0);
  fragCol = vec4(result, 1.0);
};

